
# 01_watergauge_clean_and_plot_data.R Documentation

## Script purpose
- This script is the **first step** in our Deschutes Gauge data pipeline. Its primary goal is to take raw flow and temperature data from two different files, clean the column names, standardize the units, combine the datasets, and generate initial exploratory plots.

This script ensures the rest of the workflow (Scripts 02 and 03) works with a single, clean, consistent data source.

---

## Dependencies and Setup

This script requires the following R packages. They must be installed before running the script:

R
install.packages(c("readr", "dplyr", "lubridate", "janitor", "ggplot2", "zoo", "scales", "here", "rlang"))
   
### Important Setup Note
This script relies on the **here()** package to find files. You must open RStudio by **double-clicking the .Rproj file** at the root of the project folder before running any code.

## How It Works (Core Workflow)

The script is structured to perform the following steps:

1.  **Read Raw Data:** Uses here() to safely read two raw CSV files located in `data/watergauge_deschutes/madras_watergage_raw/:
    * raw_moody_madras_USGS_flow_n_temp.csv
    * raw_madras_USGS_flow_n_temp.csv

2.  **Clean and Standardize:** The reusable **clean_and_prep_data()** function is applied to **both** datasets. This function handles:
    * Cleaning column headers to snake\_case using janitor::clean_names().
    * Standardizing the date column using lubridate::mdy().
    * Converting flow from **CFS to CMS** ($1 \text{ CFS} = 0.0283168 \text{ CMS}$).
    * Calculating the **Water Year** (defined as starting on October 1st).

3.  **Combine Data:** The two cleaned datasets are merged into a single standardized data frame called df_combined.

4.  **Aggregate Monthly Data:** Calculates monthly means for flow and temperature for both sites, stored in df_monthly_combined.

##  Outputs Generated by this Script

The script creates the following essential files, automatically placing them in the correct output directories:

| Output File Name | Location | Description |
| :--- | :--- | :--- |
| **cleaned_combined_data.csv** | data/.../madras_watergage_clean/ | The complete, cleaned daily data for both sites. **This is the primary input for Script 02.** |
| combined_hydrograph_daily_by_wy.png | plots/ | Daily flow faceted by site and water year. |
| combined_hydrograph_7day_by_wy.png | plots/ | Daily flow vs. 7-day rolling mean flow. |
| combined_monthly_means_by_wy.png | plots/ | Monthly mean flow for each site. |
| combined_monthly_discharge_temp_overlay_by_wy.png | plots/ | Monthly mean flow and temperature overlayed on a dual axis. |
| combined_flow_duration_curve_all.png | plots/ | Flow-duration curve comparing the long-term discharge probability for both sites. |
| qa_missing_counts_combined.csv | docs/ | Simple table summarizing the number of missing (NA) values for flow and temperature for each site. |
